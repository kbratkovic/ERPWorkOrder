@page "/clients"

@inject ClientModel Client;
@inject DialogService DialogService
@inject NavigationManager NavigationManager

@inherits OwningComponentBase<IClientRepository>


<PageTitle>Klijenti</PageTitle>

<NavLink href="@CreateNewClient" class="btn mb-4">
    <RadzenButton Text="Novi klijent" ButtonStyle="ButtonStyle.Secondary" />
</NavLink>


<RadzenButton Text="Open dialog" ButtonStyle="ButtonStyle.Secondary" Click=@OpenOrder />


<table class="table table-striped table-bordered table-sm">
    <thead>
        <tr>
            <th scope="col">Rb.</th>
            <th scope="col">Tvrtka</th>
            <th scope="col">OIB</th>
            <th scope="col">Grad</th>
            <th scope="col">Adresa</th>
            <th scope="col">Kontakt</th>
            <th scope="col">Telefon</th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        @if (ClientData?.Count() > 0)
        {
            foreach (var client in ClientData)
            {
                orderNumber++;
                <tr>
                    <td>@orderNumber</td>
                    <td>@client.CompanyName</td>
                    <td>@client.TaxNumber</td>
                    <td>@client.City</td>
                    <td>@client.Address</td>
                    <td>@client.ContactPerson</td>
                    <td>@client.PhoneNumber</td>
                    <td class="text-center"><NavLink class="btn btn-warning" href="@EditContact(client.Id)">Uredi</NavLink></td>
                </tr>
            }
        }
    </tbody>
</table>



@code {

    private int orderNumber;
    private IClientRepository Repository => Service;
    public IEnumerable<ClientModel> ClientData { get; set; } = Enumerable.Empty<ClientModel>();



    protected async override Task OnInitializedAsync()
    {
        await UpdateData();
        orderNumber = 0;

    }


    public async Task UpdateData()
    {
        ClientData = await Repository.Clients.ToListAsync();
    }


    public string CreateNewClient => $"/client/create";

    public string EditContact(int id) => $"/client/edit/{id}";



    // RadzenDialog Demo
    public int orderID = 12345;

    public async Task OpenOrder()
    {
        await DialogService.OpenAsync<Clients>($"Order {orderID}", null, null);
    }


}
